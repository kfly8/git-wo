; git-wo sandbox profile
; Restricts file writes to worktree directory only
;
; Parameters:
;   HOME           - User's home directory
;   WORKTREE_PATH  - Worktree directory (write allowed)
;   REPO_PATH      - Main repository's .git directory (write allowed)
;
; Usage:
;   sandbox-exec -f git-wo.sb \
;     -D HOME=$HOME \
;     -D WORKTREE_PATH=/path/to/worktree \
;     -D REPO_PATH=/path/to/repo/.git \
;     $SHELL
;
; Based on claude-task.sb:
;   https://github.com/kfly8/claude-task

(version 1)

; Allow most operations by default
(allow default)

; ===========================================
; File Write Restrictions
; ===========================================

; Deny all writes under HOME
(deny file-write*
  (subpath (param "HOME")))

; Allow writes only to the specific worktree directory
(allow file-write*
  (subpath (param "WORKTREE_PATH")))

; Allow writes to main repository's .git directory (needed for worktree operations)
(allow file-write*
  (subpath (param "REPO_PATH")))

; Allow writes to Claude Code config/cache directories
(allow file-write*
  (subpath (string-append (param "HOME") "/.claude"))
  (literal (string-append (param "HOME") "/.claude.json")))

; Allow writes to bun global cache directory (needed for bun install)
(allow file-write*
  (subpath (string-append (param "HOME") "/.bun")))

; Allow writes to /tmp and /var (needed for various tools)
(allow file-write*
  (subpath "/tmp")
  (subpath "/private/tmp")
  (subpath "/var"))

; ===========================================
; Notes
; ===========================================
; - Network access is NOT restricted
; - Process spawning is NOT restricted
; - File reads are NOT restricted
